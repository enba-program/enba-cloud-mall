在 Docker 中，`--restart=always` 和 `--restart=unless-stopped` 都是容器的自动重启策略，但它们在**手动停止容器后的行为**有所不同。以下是它们的详细区别：

---

## **1. `--restart=always`**
### **行为**
- **容器退出时自动重启**（无论退出原因是什么，包括正常退出、异常崩溃、OOM 等）。
- **例外**：如果用户**手动执行 `docker stop` 或 `docker kill`**，容器**不会自动重启**（这是 Docker 的默认设计）。
- **Docker 守护进程（dockerd）重启时**：容器会自动启动（即使之前是手动停止的）。

### **适用场景**
- 需要容器**在任何非手动停止的情况下都保持运行**。
- 例如：关键服务（如数据库、Web 服务器），即使意外崩溃也要立即恢复。

---

## **2. `--restart=unless-stopped`**
### **行为**
- **容器退出时自动重启**（与 `always` 类似）。
- **手动停止（`docker stop`）后**：容器**不会自动重启**，即使 Docker 守护进程重启也不会启动它。
- **Docker 守护进程（dockerd）重启时**：
    - 如果容器是**手动停止的**，**不会启动**。
    - 如果容器是**因其他原因（如崩溃、OOM）退出的**，**会启动**。

### **适用场景**
- 希望容器在**手动停止后保持停止状态**，但在其他情况下（如崩溃、系统重启）自动恢复。
- 例如：临时调试的容器，手动停止后不希望它再自动运行。

---

## **关键区别总结**
| **行为**                     | `--restart=always` | `--restart=unless-stopped` |
|-----------------------------|-------------------|---------------------------|
| **正常退出（Exit 0）**       | ✅ 重启            | ✅ 重启                   |
| **异常退出（非 0 Exit）**    | ✅ 重启            | ✅ 重启                   |
| **OOM（内存不足）终止**      | ✅ 重启            | ✅ 重启                   |
| **手动 `docker stop`**       | ❌ 不重启          | ❌ 不重启                 |
| **Docker 守护进程重启时**    | ✅ 启动（即使之前手动停止） | ❌ 如果手动停止则不启动 |

---

## **示例**
### **1. `--restart=always`**
```bash
docker run -d --restart=always nginx
```
- 如果手动 `docker stop nginx`，容器不会重启。
- 但如果 Docker 服务重启（如 `systemctl restart docker`），容器**会重新启动**（即使之前是手动停止的）。

### **2. `--restart=unless-stopped`**
```bash
docker run -d --restart=unless-stopped nginx
```
- 如果手动 `docker stop nginx`，容器不会重启，即使 Docker 服务重启也不会启动。
- 如果容器因崩溃退出，Docker 会重新启动它。

---

## **如何选择？**
- **`always`**：适用于**必须长期运行的服务**（如数据库、Web 服务器），即使手动停止后 Docker 重启也要恢复。
- **`unless-stopped`**：适用于**临时或可手动控制的服务**，手动停止后不希望它自动恢复。

