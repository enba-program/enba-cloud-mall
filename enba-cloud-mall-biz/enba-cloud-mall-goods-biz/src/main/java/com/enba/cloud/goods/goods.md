# 商城系统商品模块业务流程设计

## 一、商品状态定义

### 1. 上架状态

| 状态码 | 状态名称 | 说明             |
|-----|------|----------------|
| 1   | 已上架  | 商品可被用户浏览和购买    |
| 0   | 已下架  | 商品不可见，但数据保留    |
| 2   | 待上架  | 商品已审核通过，等待手动上架 |

### 2. 审核状态

| 状态码 | 状态名称  | 说明         |
|-----|-------|------------|
| 0   | 待审核   | 商品提交后等待审核  |
| 1   | 审核通过  | 商品通过审核     |
| 2   | 审核不通过 | 商品未通过审核    |
| 3   | 草稿    | 商品创建但未提交审核 |

## 二、业务流程

### 1. 商品创建与编辑

- **流程**：
    1. 商家/运营人员在商品管理界面创建新商品或编辑现有商品
    2. 填写商品信息（基本信息、价格、库存、SKU、图片等）
    3. 保存商品信息，系统自动将商品状态设置为"草稿"(审核状态=3)

- **业务规则**：
    - 草稿状态的商品不会展示给用户
    - 可随时编辑草稿状态的商品
    - 草稿状态的商品可以提交审核或删除

### 2. 商品提交审核

- **流程**：
    1. 商家/运营人员确认商品信息无误
    2. 点击"提交审核"按钮
    3. 系统将商品审核状态更新为"待审核"(审核状态=0)
    4. 系统通知相关审核人员

- **业务规则**：
    - 只有草稿状态的商品可以提交审核
    - 提交审核后，商品信息锁定，不允许直接修改
    - 如需修改，需先撤回审核（如有权限）

### 3. 审核流程

- **流程**：
    1. 审核人员登录系统，查看待审核商品列表
    2. 点击审核商品，查看详细信息
    3. 进行审核：
        - 审核通过：系统将商品审核状态更新为"审核通过"(审核状态=1)
        - 审核不通过：系统将商品审核状态更新为"审核不通过"(审核状态=2)，并记录不通过原因
    4. 系统通知提交审核的商家/运营人员审核结果

- **业务规则**：
    - 审核人员必须根据既定规则进行审核
    - 审核不通过时必须提供明确的原因
    - 审核通过后，商品进入待上架状态（除非手动上架）

### 4. 商品上架流程

- **流程**：
    1. 对于审核通过的商品：
        - 商家/运营人员可以选择立即上架或保持待上架状态
        - 如选择立即上架：系统将商品上架状态更新为"已上架"(上架状态=1)
        - 如选择保持待上架：系统保持商品上架状态为"待上架"(上架状态=2)
    2. 对于待上架状态的商品：
        - 商家/运营人员可以在需要时手动上架
        - 系统将商品上架状态更新为"已上架"(上架状态=1)
        - 商品正式对外展示，可被用户浏览和购买

- **业务规则**：
    - 只有审核通过的商品可以上架
    - 上架操作需要记录操作人和时间
    - 上架后商品状态实时更新，用户可立即看到

### 5. 商品下架流程

- **流程**：
    1. 商家/运营人员选择需要下架的商品
    2. 点击"下架"按钮
    3. 系统将商品上架状态更新为"已下架"(上架状态=0)
    4. 商品不再对外展示，但数据保留

- **业务规则**：
    - 任何状态的商品（只要已上架）都可以下架
    - 下架操作需要记录操作人和时间
    - 下架后的商品可以重新上架

### 6. 商品编辑与状态变更

- **流程**：
    1. 对于不同状态的商品，编辑权限和流程不同：
        - 草稿状态：可直接编辑
        - 待审核状态：不可直接编辑（需撤回审核）
        - 审核通过/待上架/已上架状态：不可直接编辑（需先下架）
    2. 根据商品当前状态，执行相应编辑流程：
        - 草稿：直接修改并保存
        - 待审核/审核通过：提交"撤回审核"申请（如权限允许），审核通过后变为草稿状态，再进行编辑
        - 待上架/已上架：先下架，变为待上架状态，再编辑
    3. 编辑完成后，根据需要重新提交审核或直接上架

- **业务规则**：
    - 商品信息变更需遵循相应的审核流程
    - 敏感信息变更（如价格、库存）可能需要特殊审批
    - 编辑历史应记录，便于追溯

### 7. 商品删除流程

- **流程**：
    1. 商家/运营人员选择需要删除的商品
    2. 系统检查商品状态：
        - 草稿状态：可直接删除
        - 其他状态：提示需先下架并删除相关数据（如订单关联）
    3. 执行删除操作，系统从数据库中移除商品信息或标记为已删除

- **业务规则**：
    - 删除操作不可逆，需谨慎执行
    - 有订单关联的商品可能需要特殊处理
    - 删除操作需要记录操作人和时间

## 三、状态转换图

```mermaid
stateDiagram-v2
    [*] --> 草稿
    草稿 --> 待审核: 提交审核
    待审核 --> 审核通过: 审核通过
    待审核 --> 审核不通过: 审核不通过
    审核通过 --> 待上架: 默认
    审核通过 --> 已上架: 手动上架
    待上架 --> 已上架: 手动上架
    已上架 --> 已下架: 手动下架
    已下架 --> 已上架: 手动上架